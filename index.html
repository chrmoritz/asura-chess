<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Asura Chess by Ignitas</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="Guild Wars2, GW2, Ausra Chess">
		<meta name="author" content="Ignitas">
		<link rel="shortcut icon" href="images/icon.png">
		<link href="http://rc.getbootstrap.com/assets/css/bootstrap.css" rel="stylesheet">
		<style type="text/css">
			@media (min-width: 1280px){
				body{
					background-image: url(images/body.jpg);
					background-repeat: no-repeat;
					background-position: center 40px;
				}
			}
			
			body{
				margin: 40px 0px;
			}
			.form-actions{
				text-align: center;
			}
			.gamebtn{
				width: 200px;
			}
			.cell{
				background-image: url(images/default.png);
				width: 128px;
				height: 128px;
				border:1px solid black;
				text-align: center;
				float:left;
				opacity:0.8;
				filter:alpha(opacity=80);
			}
			.row{
				clear:both;
			}
			#map{
				background-image: url(images/asura1.jpg);
				-webkit-background-size: cover;
				-moz-background-size: cover;
				-o-background-size: cover;
				background-size: cover;
				position:absolute;
				left:50%;
				top:50%;
				margin-left: -449px;
				margin-top: -345px;
				padding: 88px 256px;
				width: 386px;
				height: 386px;
				border: 1px solid rgba(0, 0, 0, 1);
				box-shadow: 4px 5px 6px rgba(0, 0, 0, 0.5);
			}
			#options{
				position:absolute;
				left:652px;
				width:200px;
				top:88px;
				opacity:0.8;
				filter:alpha(opacity=80);
			}
		</style>
		<script src="http://code.jquery.com/jquery-1.8.2.min.js" type="text/javascript"></script>
		<script type="text/javascript" async>
			var game;
			var timeout;
			$(function(){
				game=new Game();
				$(".gamebtn").removeAttr("disabled");
				
				function mod(x,y){
					var r=x%y;
					if (r<0){
						r+=y;
					}
					return r;
				}
				
				function setCell(golem,x,y,o,hp){
					if (golem===1 || !game || game.bot===0){
						$('#cell'+x+y).css('background-position',(o*-128)+'px '+(golem*-128)+'px');
					}
					else {
						$('#cell'+x+y).css('background-position','-128px 0px');
					}
					var rhp=Math.floor(hp+0.5);
					$('#cell'+x+y).html('<div class="progress" style="margin: 5px 8px 0px;height:15px;"><div class="bar bar-success" style="width:'+rhp+'%;"></div><div class="bar bar-danger" style="width:'+(100-rhp)+'%;"></div></div>');
				}
				
				function clearCell(x,y){
					$('#cell'+x+y).css('background-position','0px 0px').html('');
				}
				
				function victory(golem){
					$('.gamebtn').hide();
					if (golem===2 && game.bot>0){
						$('#currentplayer').text('You were defeated by '+((game.bot===1)?'an easy':((game.bot===2)?'a normal':'an unbeatable'))+' bot! Try it again!');
						$('#currentplayer').css('color','red');
					}
					else{
						$('#currentplayer').text('Golem '+golem+' wins! Congratulation!');
						$('#currentplayer').css('color','green');
					}
					$('.newgame').fadeIn();
				}
				
				$('.newgame').click(function(){
					clearTimeout(timeout);
					$(".gamebtn").removeAttr("disabled");
					$('.cell').css('background-position','0px 0px').html('');
					$('#currentplayer').text('Current player: Golem 1');
					$('#currentplayer').css('color','blue');
					game=new Game();
					$('button.newgame').hide();
					$('.gamebtn').fadeIn();
				});
				
				$("#backselect").val('asura1');
				$('#backselect').change(function(){
					$('#map').css('background-image','url(images/'+$(this).val()+'.jpg)');
				});
				
				$("#textureselect").val('default');
				$('#textureselect').change(function(){
					$('.cell').css('background-image','url(images/'+$(this).val()+'.png)');
				});
				
				$("#langselect").val('en');
				$('#langselect').change(function(){
					if ($(this).val()=='en'){
						localize({});
					}
					$.getJSON('js/'+$(this).val()+'.json', function(data) {
						localize(eval(data));
					});
				});
				$('#usebot').attr('checked', false);
				
				$("body").keypress(function(event){
					if ($(".gamebtn:disabled").length==0){
						if (event.which==49){
							game.turnLeft();
						}
						if (event.which==50){
							game.moveForward();
						}
						if (event.which==51){
							game.turnRight();
						}
						if (event.which==52){
							game.attack();
						}
						if (event.which==53){
							game.skip();
						}
					}
				});

				
				function localize(data){
					$('.localized').each(function(){
						var oldtext=$(this).text();
						if (data[oldtext]!=null){
							$(this).data('oriloc',oldtext);
							$(this).text(data[oldtext]);
						}
						else{
							if ($(this).data('oriloc')!=null){
								$(this).text($(this).data('oriloc'));
							}
						}
					});
				}
				
				function Game(){
					this.bot=$('#usebot:checked').length===0?0:parseInt($('#botdif').val())
					this.g1=new Golem(1,0,0,2);setCell(1,0,0,2,100); //Golem1
					this.g2=new Golem(2,2,2,0);setCell(2,2,2,0,100); //Golem2
					this.turn=true; //true if golem1s turn, false if golem2s turn
					//pickups (under construction)
					
					this.turnLeft=function(){
						(this.turn?this.g1:this.g2).turnLeft();
					};
					
					this.turnRight=function(){
						(this.turn?this.g1:this.g2).turnRight();
					};
					
					this.moveForward=function(){
						if ((this.turn?this.g1:this.g2).moveForward()){
							this.skip();
						}
					};
					
					this.attack=function(){
						var other=(this.turn?this.g2:this.g1);
						if ((this.turn?this.g1:this.g2).canAttack(other)){
							if (other.setDamange(100/3)){
								setCell(other.id,other.x,other.y,other.o,other.hp);
								this.skip();
							}
							else{
								setCell(other.id,other.x,other.y,other.o,other.hp);
							}
						}
					};
					
					this.skip=function(){
						$(".gamebtn").removeAttr("disabled");
						this.turn=!this.turn;
						$('#currentplayer').text('Current player: Golem '+(this.turn?'1':((this.bot===0)?'2':'2 (bot)')));
						$('#currentplayer').css('color',this.turn?'blue':'red');
						if (!this.turn && this.bot>0){//unbeatable bot
							$(".gamebtn").attr("disabled", "disabled");
							timeout=setTimeout(function(){game.runbot();},800);
						}
					};
					
					this.runbot=function(){
						var dx=Math.abs(this.g1.x-this.g2.x);
						var dy=Math.abs(this.g1.y-this.g2.y);
							if ((dx+dy)%2===0){
								if (this.bot===3){
									timeout=setTimeout(function(){game.skip();},200);
									return; //skip turn -> unbeatable
								}// else bot perfekt turn now
							}
							if (dx+dy===1){
								if (this.g1.setDamange(100/3)){
									setCell(this.g1.id,this.g1.x,this.g1.y,this.g1.o,this.g1.hp);
									timeout=setTimeout(function(){game.skip();},200);
								}
								else{
									setCell(this.g1.id,this.g1.x,this.g1.y,this.g1.o,this.g1.hp);
								}
								return;
							}
							clearCell(this.g2.x,this.g2.y);
							if (this.bot===1){ //easy bot with senseless turn
								var or=[];
								if (this.g2.x>0){or.push(3);}
								if (this.g2.x<2){or.push(1);}
								if (this.g2.y>0){or.push(0);}
								if (this.g2.y<2){or.push(2);}
								this.g2.o=or[Math.floor(Math.random()*or.length)];
								this.g2.moveForward();
							}
							else{
								if (dx>dy){
									this.g2.x=(this.g1.x<this.g2.x)?this.g2.x-1:this.g2.x+1;
								}
								if (dx===dy){//normal bot unperfekt turn
									if (dx===2){//start position
										if (Math.random()>0.5){
											this.g2.y=(this.g1.y<this.g2.y)?this.g2.y-1:this.g2.y+1;
										}
										else{
											this.g2.x=(this.g1.x<this.g2.x)?this.g2.x-1:this.g2.x+1;
										}
									}
									else{
										if (this.g2.x==1 && this.g2.y==1){ //middle -> run away (random one of 2 possibility)
											if (Math.random()>0.5){
													this.g2.y=(this.g1.y<this.g2.y)?this.g2.y+1:this.g2.y-1;
												}
												else{
													this.g2.x=(this.g1.x<this.g2.x)?this.g2.x+1:this.g2.x-1;
												}
										}
										else {
											if ((this.g2.x+this.g2.y)%2===0){//corner -> random attackable position
												if (Math.random()>0.5){
													this.g2.y=(this.g1.y<this.g2.y)?this.g2.y-1:this.g2.y+1;
												}
												else{
													this.g2.x=(this.g1.x<this.g2.x)?this.g2.x-1:this.g2.x+1;
												}
											}
											else{//edge -> run away (only one possibility)
												if (this.g2.x!=1){
													this.g2.y=(this.g1.y<this.g2.y)?this.g2.y+1:this.g2.y-1;
												}
												else{
													this.g2.x=(this.g1.x<this.g2.x)?this.g2.x+1:this.g2.x-1;
												}
											}
										}
									}
								}//end unperfekt normal bot turn
								if(dx<dy){
									this.g2.y=(this.g1.y<this.g2.y)?this.g2.y-1:this.g2.y+1;
								}
								setCell(this.g2.id,this.g2.x,this.g2.y,this.g2.o,this.g2.hp);
							}
							timeout=setTimeout(function(){game.skip();},200);
					};
				}// End of Game

				function Golem(id,x,y,o){
					this.id=id; //1 for Golem 1 and 2 for Golem 2
					this.x=x; //x position of golem 0..2
					this.y=y; //y position of golem 0..2
					this.o=o; //oriantation of golem 0..3 (0=north,1=east,2=south,3=west)
					this.hp=100; //health point of the golem 0..100
					
					this.turnLeft=function(){
						this.o=mod(this.o-1,4);
						setCell(this.id,this.x,this.y,this.o,this.hp);
					};
					
					this.turnRight=function(){
						this.o=mod(this.o+1,4);
						setCell(this.id,this.x,this.y,this.o,this.hp);
					};
					
					this.canMove=function(){
						if (this.canAttack((this.id===1)?game.g2:game.g1)){
							return false;
						}
						switch(this.o){
							case 0: return this.y>0;
							case 1: return this.x<2;
							case 2: return this.y<2;
							case 3: return this.x>0;
							default: console.warn('illigal oriantation: '+this.o); return false;        
						}
					};
					
					this.moveForward=function(){
						if (!this.canMove()){
							return false;
						}
						clearCell(this.x,this.y);
						switch(this.o){
							case 0: this.y--; break;
							case 1: this.x++; break;
							case 2: this.y++; break;
							case 3: this.x--; break;
							default: console.warn('illigal oriantation: '+this.o); setCell(this.id,this.x,this.y,this.o,this.hp); return false;        
						}
						setCell(this.id,this.x,this.y,this.o,this.hp);
						return true;
					};
					
					this.canAttack=function(other){
						if (this.o%2===0){ //vertical
							return this.x===other.x && this.y===other.y-this.o+1;
						}
						else{ //horizontal
							return this.y===other.y && this.x-this.o+2===other.x;
						}
					};
					
					this.setDamange=function(dmg){
						this.hp-=dmg;
						if (this.hp<0.00000001){
							victory(this.id===1?2:1);
							return false;
						}
						return true;
					};
				}// End of Golem
			});
		</script>
	</head>
	<body>
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<a class="brand" href="#" style="margin-left: 10px;padding: 0px 20px;"><img height="64" src="images/icon.png" style="margin-right:5px;"> <span class="localized">Asura Chess by Ignitas<span></a>
					<ul class="nav pull-right" style="margin-right: 30px;">
						<li class="navbar-text"><span class="localized">Background:</span> 
							<select id="backselect" style="margin-bottom:0px;width:100px;">
								<option value="asura1" selected>Asura 1</option>
								<option value="asura2">Asura 2</option>
								<option value="asura3">Asura 3</option>
								<option value="castle">Castle</option>
								<option value="zhaitan">Zhaitan</option>
								<option value="ascalon">Ascalon</option>					
							</select>
						</li>
						<li class="divider-vertical"></li>
						<li class="navbar-text"><span class="localized">Textures:</span> 
							<select id="textureselect" style="margin-bottom:0px;width:140px;">
								<option class="localized" value="default">default (alpha)</option>
							</select>
						</li>
						<li class="divider-vertical"></li>
						<li class="navbar-text"><span class="localized">Language:</span> 
							<select id="langselect" style="margin-bottom:0px;width:60px;">
								<option value="en">en</option>
								<option value="de">de</option>
							</select>
						</li>
					</ul>
				</div>
		</div>
	</div>

	<div id="map">
		<div class="well well-small" id="options">
			<h4 style="text-align:center;" class="localized">Options</h4>
				<label class="checkbox"><input type="checkbox" id="usebot"> <span class="localized">use bot for golem 2</span></label>
				<label class="select"><span class="localized">difficulty:</span> <select style="width:120px;" id="botdif"><option value="1" class="localized">easy</option><option value="2" class="localized">normal</option><option value="3" class="localized">unbeatable</option></select></label>
				<label class="checkbox"><input type="checkbox" disabled> <span class="localized">random pickups</span></label>
				<span class="help-block localized">(under development)</span>
				<a class="btn btn-block newgame localized">Restart game ...</a>
		</div>
		<div class="row">
			<div class="cell" id="cell00"></div>
			<div class="cell" id="cell10"></div>
			<div class="cell" id="cell20"></div>
		</div>
		<div class="row">
			<div class="cell" id="cell01"></div>
			<div class="cell" id="cell11"></div>
			<div class="cell" id="cell21"></div>
		</div>
		<div class="row">
			<div class="cell" id="cell02"></div>
			<div class="cell" id="cell12"></div>
			<div class="cell" id="cell22"></div>
		</div>
	</div>

	<div class="form-actions navbar-fixed-bottom" style="bottom:40px;padding-top: 0px;">
		<h3 id="currentplayer" style="color: blue;text-align:center;">Current player: Golem 1</span></h3>
		<button class="btn btn-large gamebtn localized" onclick="game.turnLeft()">Turn left</button>
		<button class="btn btn-primary btn-large gamebtn localized" onclick="game.moveForward()">Move forward</button>
		<button class="btn btn-large gamebtn localized" onclick="game.turnRight()">Turn right</button>
		<button class="btn btn-primary btn-large gamebtn localized" onclick="game.attack()">Attack enemy</button>
		<button class="btn btn-warning btn-large gamebtn localized" onclick="game.skip()">Skip turn</button>
		<button class="btn btn-primary btn-large btn-block newgame localized" style="display:none;">Start new game ...</button>
	</div>
	
	<div class="navbar navbar-inverse navbar-fixed-bottom">
		<div class="navbar-inner">
			<p class="navbar-text" style="text-align:center;"><span class="localized">Game idea and concept art from</span> <a href="http://www.guildwars2.com/">Guild Wars 2</a>: <span title="&copy; 2011 ArenaNet, Inc. All rights reserved. NCsoft, the interlocking NC logo, ArenaNet, Arena.net, Guild Wars, Guild Wars Factions, Factions, Guild Wars Nightfall, Nightfall, Guild Wars: Eye of the North, Guild Wars Eye of the North, Eye of the North, Guild Wars 2, and all associated logos and designs are trademarks or registered trademarks of NCsoft Corporation. All other trademarks are the property of their respective owners.">&copy; 2011 ArenaNet, Inc. All rights reserved.</span>  <span class="divider-vertical"></span>  <span class="localized">web programming:</span> <a href="http://forum-de.guildwars2.com/members/Ignitas-9573">Ignitas</a></p>
		</div>
	</div>
	</body>
</html>